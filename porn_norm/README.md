#这个notebook是关于色情图片识别的例子#


----------

###色情识别需要数据集，我已经处理好放在github中，32*32的图片，使用卷积神经网络，最后达到98%的正确率，还是很不错的###

```python
from keras.utils import np_utils
from data import load_data
```


```python
from __future__ import absolute_import
from __future__ import print_function
from keras.preprocessing.image import ImageDataGenerator
from keras.models import Sequential
from keras.layers.core import Dense, Dropout, Activation, Flatten
from keras.layers.advanced_activations import PReLU
from keras.layers.convolutional import Convolution2D, MaxPooling2D
from keras.optimizers import SGD, Adadelta, Adagrad
from keras.utils import np_utils, generic_utils
from six.moves import range
from data import load_data
import random
```

    Using Theano backend.
    Using gpu device 0: GeForce GT 635M (CNMeM is disabled)
    D:\Anaconda\lib\site-packages\theano-0.8.0.dev0-py2.7.egg\theano\tensor\signal\downsample.py:5: UserWarning: downsample module has been moved to the pool module.
      warnings.warn("downsample module has been moved to the pool module.")
    


```python
data, label = load_data()
```


```python
from sklearn.cross_validation import train_test_split
```


```python
X_train,X_test,y_train,y_test = train_test_split(data,label)
```


```python
len(X_train)
```




    15000




```python
Y_train = np_utils.to_categorical(y_train,2)
Y_test = np_utils.to_categorical(y_test,2)

X_train = X_train.astype('float32')
X_test = X_test.astype('float32')
X_train /= 255
X_test /=255
```


```python
def make_network():
    model = Sequential()
    model.add(Convolution2D(32,3,3,border_mode='same',input_shape=(3,32,32)))
    model.add(Activation('relu'))
    model.add(Convolution2D(32,3,3))
    model.add(Activation('relu'))
    model.add(MaxPooling2D(pool_size=(2,2)))
    model.add(Dropout(0.25))

    model.add(Convolution2D(64,3,3,border_mode='same'))
    model.add(Activation('relu'))
    model.add(Convolution2D(64,3,3))
    model.add(Activation('relu'))
    model.add(MaxPooling2D(pool_size=(2,2)))
    model.add(Dropout(0.25))

    model.add(Flatten())
    model.add(Dense(512))
    model.add(Activation('relu'))
    model.add(Dropout(0.5))
    model.add(Dense(2))
    model.add(Activation('softmax'))

    return model
```


```python
batch_size = 32
nb_epoch = 200
def train_model(model,X_train,Y_train,X_test,Y_test):
    sgd = SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
    model.compile(loss='categorical_crossentropy', optimizer=sgd)
    model.fit(X_train, Y_train, nb_epoch=nb_epoch, batch_size=batch_size,
             validation_split=0.1, show_accuracy=True, verbose=1)
    print('Testing...')
    res = model.evaluate(X_test, Y_test,
                        batch_size=batch_size, verbose=1, show_accuracy=True)
    print('Test accuracy: {0}'.format(res[1]))
```


```python
model = make_network()
```


```python
train_model(model,X_train,Y_train,X_test,Y_test)
```

    Train on 13500 samples, validate on 1500 samples
    Epoch 1/200
    13500/13500 [==============================] - 104s - loss: 0.4326 - acc: 0.7988 - val_loss: 0.3267 - val_acc: 0.8667
    Epoch 2/200
    13500/13500 [==============================] - 105s - loss: 0.2413 - acc: 0.9054 - val_loss: 0.2032 - val_acc: 0.9140
    Epoch 3/200
    13500/13500 [==============================] - 106s - loss: 0.1706 - acc: 0.9330 - val_loss: 0.1172 - val_acc: 0.9547
    Epoch 4/200
    13500/13500 [==============================] - 110s - loss: 0.1223 - acc: 0.9541 - val_loss: 0.1026 - val_acc: 0.9600
    Epoch 5/200
    13500/13500 [==============================] - 111s - loss: 0.1128 - acc: 0.9576 - val_loss: 0.1227 - val_acc: 0.9527
    Epoch 6/200
    13500/13500 [==============================] - 105s - loss: 0.0980 - acc: 0.9627 - val_loss: 0.0769 - val_acc: 0.9740
    Epoch 7/200
    13500/13500 [==============================] - 105s - loss: 0.0830 - acc: 0.9691 - val_loss: 0.0733 - val_acc: 0.9733
    Epoch 8/200
    13500/13500 [==============================] - 106s - loss: 0.0766 - acc: 0.9725 - val_loss: 0.0728 - val_acc: 0.9733
    Epoch 9/200
    13500/13500 [==============================] - 105s - loss: 0.0743 - acc: 0.9739 - val_loss: 0.0679 - val_acc: 0.9720
    Epoch 10/200
    13500/13500 [==============================] - 105s - loss: 0.0610 - acc: 0.9791 - val_loss: 0.0616 - val_acc: 0.9760
    Epoch 11/200
    13500/13500 [==============================] - 105s - loss: 0.0594 - acc: 0.9788 - val_loss: 0.0618 - val_acc: 0.9760
    Epoch 12/200
    13500/13500 [==============================] - 105s - loss: 0.0603 - acc: 0.9780 - val_loss: 0.0780 - val_acc: 0.9713
    Epoch 13/200
    13500/13500 [==============================] - 106s - loss: 0.0556 - acc: 0.9794 - val_loss: 0.0668 - val_acc: 0.9753
    Epoch 14/200
    13500/13500 [==============================] - 106s - loss: 0.0511 - acc: 0.9819 - val_loss: 0.0713 - val_acc: 0.9747
    Epoch 15/200
    13500/13500 [==============================] - 106s - loss: 0.0541 - acc: 0.9812 - val_loss: 0.0678 - val_acc: 0.9760
    Epoch 16/200
    13500/13500 [==============================] - 107s - loss: 0.0472 - acc: 0.9824 - val_loss: 0.0636 - val_acc: 0.9800
    Epoch 17/200
    13500/13500 [==============================] - 106s - loss: 0.0414 - acc: 0.9844 - val_loss: 0.0750 - val_acc: 0.9753
    Epoch 18/200
    13500/13500 [==============================] - 106s - loss: 0.0415 - acc: 0.9839 - val_loss: 0.0703 - val_acc: 0.9753
    Epoch 19/200
    13500/13500 [==============================] - 106s - loss: 0.0371 - acc: 0.9859 - val_loss: 0.0603 - val_acc: 0.9800
    Epoch 20/200
    13500/13500 [==============================] - 106s - loss: 0.0372 - acc: 0.9870 - val_loss: 0.0718 - val_acc: 0.9780
    Epoch 21/200
    13500/13500 [==============================] - 106s - loss: 0.0348 - acc: 0.9884 - val_loss: 0.0719 - val_acc: 0.9793
    Epoch 22/200
    13500/13500 [==============================] - 106s - loss: 0.0367 - acc: 0.9860 - val_loss: 0.0701 - val_acc: 0.9800
    Epoch 23/200
    13500/13500 [==============================] - 106s - loss: 0.0303 - acc: 0.9875 - val_loss: 0.0750 - val_acc: 0.9787
    Epoch 24/200
    13500/13500 [==============================] - 107s - loss: 0.0344 - acc: 0.9871 - val_loss: 0.0798 - val_acc: 0.9733
    Epoch 25/200
    13500/13500 [==============================] - 107s - loss: 0.0343 - acc: 0.9874 - val_loss: 0.0640 - val_acc: 0.9793
    Epoch 26/200
    13500/13500 [==============================] - 108s - loss: 0.0262 - acc: 0.9904 - val_loss: 0.0903 - val_acc: 0.9753
    Epoch 27/200
    13500/13500 [==============================] - 107s - loss: 0.0278 - acc: 0.9899 - val_loss: 0.0718 - val_acc: 0.9800
    Epoch 28/200
    13500/13500 [==============================] - 108s - loss: 0.0243 - acc: 0.9907 - val_loss: 0.0665 - val_acc: 0.9813
    Epoch 29/200
    13500/13500 [==============================] - 106s - loss: 0.0243 - acc: 0.9914 - val_loss: 0.0828 - val_acc: 0.9707
    Epoch 30/200
    13500/13500 [==============================] - 106s - loss: 0.0234 - acc: 0.9910 - val_loss: 0.0688 - val_acc: 0.9800
    Epoch 31/200
    13500/13500 [==============================] - 106s - loss: 0.0214 - acc: 0.9933 - val_loss: 0.0722 - val_acc: 0.9767
    Epoch 32/200
    13500/13500 [==============================] - 106s - loss: 0.0241 - acc: 0.9917 - val_loss: 0.0814 - val_acc: 0.9753
    Epoch 33/200
    13500/13500 [==============================] - 106s - loss: 0.0200 - acc: 0.9930 - val_loss: 0.0701 - val_acc: 0.9780
    Epoch 34/200
    13500/13500 [==============================] - 108s - loss: 0.0212 - acc: 0.9924 - val_loss: 0.0920 - val_acc: 0.9807
    Epoch 35/200
    13500/13500 [==============================] - 108s - loss: 0.0185 - acc: 0.9940 - val_loss: 0.0776 - val_acc: 0.9813
    Epoch 36/200
    13500/13500 [==============================] - 108s - loss: 0.0227 - acc: 0.9930 - val_loss: 0.0686 - val_acc: 0.9793
    Epoch 37/200
    13500/13500 [==============================] - 107s - loss: 0.0174 - acc: 0.9933 - val_loss: 0.0871 - val_acc: 0.9747
    Epoch 38/200
    13500/13500 [==============================] - 106s - loss: 0.0173 - acc: 0.9941 - val_loss: 0.0765 - val_acc: 0.9767
    Epoch 39/200
    13500/13500 [==============================] - 114s - loss: 0.0177 - acc: 0.9938 - val_loss: 0.0689 - val_acc: 0.9787
    Epoch 40/200
    13500/13500 [==============================] - 140s - loss: 0.0137 - acc: 0.9950 - val_loss: 0.0936 - val_acc: 0.9747
    Epoch 41/200
    13500/13500 [==============================] - 132s - loss: 0.0161 - acc: 0.9942 - val_loss: 0.0756 - val_acc: 0.9780
    Epoch 42/200
    13500/13500 [==============================] - 133s - loss: 0.0176 - acc: 0.9938 - val_loss: 0.0787 - val_acc: 0.9800
    Epoch 43/200
    13500/13500 [==============================] - 139s - loss: 0.0155 - acc: 0.9939 - val_loss: 0.0806 - val_acc: 0.9787
    Epoch 44/200
    13500/13500 [==============================] - 138s - loss: 0.0134 - acc: 0.9952 - val_loss: 0.0790 - val_acc: 0.9820
    Epoch 45/200
    13500/13500 [==============================] - 133s - loss: 0.0150 - acc: 0.9939 - val_loss: 0.0765 - val_acc: 0.9767
    Epoch 46/200
    13500/13500 [==============================] - 132s - loss: 0.0126 - acc: 0.9953 - val_loss: 0.0717 - val_acc: 0.9833
    Epoch 47/200
    13500/13500 [==============================] - 111s - loss: 0.0129 - acc: 0.9956 - val_loss: 0.0812 - val_acc: 0.9767
    Epoch 48/200
    13500/13500 [==============================] - 107s - loss: 0.0107 - acc: 0.9967 - val_loss: 0.0919 - val_acc: 0.9793
    Epoch 49/200
    13500/13500 [==============================] - 107s - loss: 0.0161 - acc: 0.9941 - val_loss: 0.0894 - val_acc: 0.9767
    Epoch 50/200
    13500/13500 [==============================] - 107s - loss: 0.0184 - acc: 0.9933 - val_loss: 0.0696 - val_acc: 0.9780
    Epoch 51/200
    13500/13500 [==============================] - 107s - loss: 0.0114 - acc: 0.9964 - val_loss: 0.0927 - val_acc: 0.9780
    Epoch 52/200
    13500/13500 [==============================] - 107s - loss: 0.0123 - acc: 0.9961 - val_loss: 0.0790 - val_acc: 0.9767
    Epoch 53/200
    13500/13500 [==============================] - 106s - loss: 0.0102 - acc: 0.9964 - val_loss: 0.0826 - val_acc: 0.9807
    Epoch 54/200
    13500/13500 [==============================] - 106s - loss: 0.0108 - acc: 0.9962 - val_loss: 0.0893 - val_acc: 0.9800
    Epoch 55/200
    13500/13500 [==============================] - 106s - loss: 0.0095 - acc: 0.9974 - val_loss: 0.0898 - val_acc: 0.9753
    Epoch 56/200
    13500/13500 [==============================] - 107s - loss: 0.0113 - acc: 0.9959 - val_loss: 0.0795 - val_acc: 0.9820
    Epoch 57/200
    13500/13500 [==============================] - 107s - loss: 0.0111 - acc: 0.9961 - val_loss: 0.0837 - val_acc: 0.9793
    Epoch 58/200
    13500/13500 [==============================] - 107s - loss: 0.0136 - acc: 0.9957 - val_loss: 0.0929 - val_acc: 0.9820
    Epoch 59/200
    13500/13500 [==============================] - 106s - loss: 0.0112 - acc: 0.9965 - val_loss: 0.0701 - val_acc: 0.9847
    Epoch 60/200
    13500/13500 [==============================] - 109s - loss: 0.0108 - acc: 0.9969 - val_loss: 0.1234 - val_acc: 0.9747
    Epoch 61/200
    13500/13500 [==============================] - 111s - loss: 0.0121 - acc: 0.9959 - val_loss: 0.0890 - val_acc: 0.9753
    Epoch 62/200
    13500/13500 [==============================] - 111s - loss: 0.0092 - acc: 0.9965 - val_loss: 0.0892 - val_acc: 0.9807
    Epoch 63/200
    13500/13500 [==============================] - 114s - loss: 0.0100 - acc: 0.9967 - val_loss: 0.0924 - val_acc: 0.9780
    Epoch 64/200
    13500/13500 [==============================] - 113s - loss: 0.0092 - acc: 0.9973 - val_loss: 0.0808 - val_acc: 0.9827
    Epoch 65/200
    13500/13500 [==============================] - 112s - loss: 0.0114 - acc: 0.9956 - val_loss: 0.0751 - val_acc: 0.9840
    Epoch 66/200
    13500/13500 [==============================] - 113s - loss: 0.0053 - acc: 0.9984 - val_loss: 0.0845 - val_acc: 0.9807
    Epoch 67/200
    13500/13500 [==============================] - 110s - loss: 0.0105 - acc: 0.9964 - val_loss: 0.0791 - val_acc: 0.9820
    Epoch 68/200
    13500/13500 [==============================] - 111s - loss: 0.0073 - acc: 0.9977 - val_loss: 0.0728 - val_acc: 0.9800
    Epoch 69/200
    13500/13500 [==============================] - 113s - loss: 0.0082 - acc: 0.9977 - val_loss: 0.0877 - val_acc: 0.9793
    Epoch 70/200
    13500/13500 [==============================] - 114s - loss: 0.0089 - acc: 0.9970 - val_loss: 0.0873 - val_acc: 0.9773
    Epoch 71/200
    13500/13500 [==============================] - 114s - loss: 0.0075 - acc: 0.9978 - val_loss: 0.0951 - val_acc: 0.9793
    Epoch 72/200
    13500/13500 [==============================] - 113s - loss: 0.0080 - acc: 0.9973 - val_loss: 0.0909 - val_acc: 0.9767
    Epoch 73/200
    13500/13500 [==============================] - 112s - loss: 0.0066 - acc: 0.9975 - val_loss: 0.1018 - val_acc: 0.9807
    Epoch 74/200
    13500/13500 [==============================] - 114s - loss: 0.0084 - acc: 0.9971 - val_loss: 0.1014 - val_acc: 0.9767
    Epoch 75/200
    13500/13500 [==============================] - 109s - loss: 0.0155 - acc: 0.9949 - val_loss: 0.0969 - val_acc: 0.9727
    Epoch 76/200
    13500/13500 [==============================] - 112s - loss: 0.0063 - acc: 0.9978 - val_loss: 0.0766 - val_acc: 0.9813
    Epoch 77/200
    13500/13500 [==============================] - 110s - loss: 0.0073 - acc: 0.9972 - val_loss: 0.0844 - val_acc: 0.9787
    Epoch 78/200
    13500/13500 [==============================] - 112s - loss: 0.0075 - acc: 0.9976 - val_loss: 0.0954 - val_acc: 0.9787
    Epoch 79/200
    13500/13500 [==============================] - 113s - loss: 0.0106 - acc: 0.9964 - val_loss: 0.0894 - val_acc: 0.9793
    Epoch 80/200
    13500/13500 [==============================] - 111s - loss: 0.0068 - acc: 0.9974 - val_loss: 0.1056 - val_acc: 0.9800
    Epoch 81/200
    13500/13500 [==============================] - 112s - loss: 0.0073 - acc: 0.9974 - val_loss: 0.0928 - val_acc: 0.9840
    Epoch 82/200
    13500/13500 [==============================] - 111s - loss: 0.0051 - acc: 0.9981 - val_loss: 0.1282 - val_acc: 0.9767
    Epoch 83/200
    13500/13500 [==============================] - 114s - loss: 0.0134 - acc: 0.9952 - val_loss: 0.0809 - val_acc: 0.9820
    Epoch 84/200
    13500/13500 [==============================] - 108s - loss: 0.0081 - acc: 0.9979 - val_loss: 0.0876 - val_acc: 0.9767
    Epoch 85/200
    13500/13500 [==============================] - 113s - loss: 0.0070 - acc: 0.9973 - val_loss: 0.0838 - val_acc: 0.9793
    Epoch 86/200
    13500/13500 [==============================] - 114s - loss: 0.0065 - acc: 0.9978 - val_loss: 0.0936 - val_acc: 0.9807
    Epoch 87/200
    13500/13500 [==============================] - 107s - loss: 0.0089 - acc: 0.9978 - val_loss: 0.0845 - val_acc: 0.9827
    Epoch 88/200
    13500/13500 [==============================] - 105s - loss: 0.0064 - acc: 0.9979 - val_loss: 0.0790 - val_acc: 0.9847
    Epoch 89/200
    13500/13500 [==============================] - 105s - loss: 0.0050 - acc: 0.9981 - val_loss: 0.0838 - val_acc: 0.9820
    Epoch 90/200
    13500/13500 [==============================] - 105s - loss: 0.0069 - acc: 0.9979 - val_loss: 0.0757 - val_acc: 0.9820
    Epoch 91/200
    13500/13500 [==============================] - 106s - loss: 0.0122 - acc: 0.9961 - val_loss: 0.0781 - val_acc: 0.9780
    Epoch 92/200
    13500/13500 [==============================] - 106s - loss: 0.0060 - acc: 0.9984 - val_loss: 0.0887 - val_acc: 0.9760
    Epoch 93/200
    13500/13500 [==============================] - 105s - loss: 0.0076 - acc: 0.9973 - val_loss: 0.0923 - val_acc: 0.9793
    Epoch 94/200
    13500/13500 [==============================] - 105s - loss: 0.0099 - acc: 0.9970 - val_loss: 0.0760 - val_acc: 0.9813
    Epoch 95/200
    13500/13500 [==============================] - 106s - loss: 0.0085 - acc: 0.9969 - val_loss: 0.0874 - val_acc: 0.9807
    Epoch 96/200
    13500/13500 [==============================] - 112s - loss: 0.0098 - acc: 0.9971 - val_loss: 0.0838 - val_acc: 0.9807
    Epoch 97/200
    13500/13500 [==============================] - 115s - loss: 0.0049 - acc: 0.9984 - val_loss: 0.1152 - val_acc: 0.9753
    Epoch 98/200
    13500/13500 [==============================] - 113s - loss: 0.0051 - acc: 0.9981 - val_loss: 0.1022 - val_acc: 0.9767
    Epoch 99/200
    13500/13500 [==============================] - 107s - loss: 0.0033 - acc: 0.9988 - val_loss: 0.1015 - val_acc: 0.9793
    Epoch 100/200
    13500/13500 [==============================] - 109s - loss: 0.0086 - acc: 0.9967 - val_loss: 0.0903 - val_acc: 0.9813
    Epoch 101/200
    13500/13500 [==============================] - 111s - loss: 0.0062 - acc: 0.9981 - val_loss: 0.0848 - val_acc: 0.9820
    Epoch 102/200
    13500/13500 [==============================] - 107s - loss: 0.0030 - acc: 0.9990 - val_loss: 0.1025 - val_acc: 0.9820
    Epoch 103/200
    13500/13500 [==============================] - 106s - loss: 0.0122 - acc: 0.9965 - val_loss: 0.0876 - val_acc: 0.9773
    Epoch 104/200
    13500/13500 [==============================] - 105s - loss: 0.0065 - acc: 0.9984 - val_loss: 0.0980 - val_acc: 0.9767
    Epoch 105/200
    13500/13500 [==============================] - 105s - loss: 0.0047 - acc: 0.9986 - val_loss: 0.1161 - val_acc: 0.9787
    Epoch 106/200
    13500/13500 [==============================] - 105s - loss: 0.0066 - acc: 0.9981 - val_loss: 0.0918 - val_acc: 0.9793
    Epoch 107/200
    13500/13500 [==============================] - 105s - loss: 0.0022 - acc: 0.9992 - val_loss: 0.0977 - val_acc: 0.9793
    Epoch 108/200
    13500/13500 [==============================] - 105s - loss: 0.0040 - acc: 0.9985 - val_loss: 0.0976 - val_acc: 0.9787
    Epoch 109/200
    13500/13500 [==============================] - 106s - loss: 0.0053 - acc: 0.9982 - val_loss: 0.1056 - val_acc: 0.9773
    Epoch 110/200
    13500/13500 [==============================] - 106s - loss: 0.0088 - acc: 0.9971 - val_loss: 0.1044 - val_acc: 0.9813
    Epoch 111/200
    13500/13500 [==============================] - 105s - loss: 0.0042 - acc: 0.9987 - val_loss: 0.1282 - val_acc: 0.9767
    Epoch 112/200
    13500/13500 [==============================] - 106s - loss: 0.0050 - acc: 0.9983 - val_loss: 0.1037 - val_acc: 0.9753
    Epoch 113/200
    13500/13500 [==============================] - 106s - loss: 0.0034 - acc: 0.9985 - val_loss: 0.0983 - val_acc: 0.9793
    Epoch 114/200
    13500/13500 [==============================] - 106s - loss: 0.0042 - acc: 0.9987 - val_loss: 0.1054 - val_acc: 0.9807
    Epoch 115/200
    13500/13500 [==============================] - 105s - loss: 0.0083 - acc: 0.9974 - val_loss: 0.0949 - val_acc: 0.9767
    Epoch 116/200
    13500/13500 [==============================] - 106s - loss: 0.0060 - acc: 0.9980 - val_loss: 0.1053 - val_acc: 0.9800
    Epoch 117/200
    13500/13500 [==============================] - 106s - loss: 0.0046 - acc: 0.9984 - val_loss: 0.1045 - val_acc: 0.9773
    Epoch 118/200
    13500/13500 [==============================] - 106s - loss: 0.0063 - acc: 0.9981 - val_loss: 0.0946 - val_acc: 0.9787
    Epoch 119/200
    13500/13500 [==============================] - 106s - loss: 0.0049 - acc: 0.9986 - val_loss: 0.0853 - val_acc: 0.9813
    Epoch 120/200
    13500/13500 [==============================] - 106s - loss: 0.0084 - acc: 0.9971 - val_loss: 0.1232 - val_acc: 0.9760
    Epoch 121/200
    13500/13500 [==============================] - 106s - loss: 0.0070 - acc: 0.9973 - val_loss: 0.1246 - val_acc: 0.9747
    Epoch 122/200
    13500/13500 [==============================] - 106s - loss: 0.0083 - acc: 0.9974 - val_loss: 0.0698 - val_acc: 0.9827
    Epoch 123/200
    13500/13500 [==============================] - 106s - loss: 0.0047 - acc: 0.9986 - val_loss: 0.1123 - val_acc: 0.9800
    Epoch 124/200
    13500/13500 [==============================] - 111s - loss: 0.0067 - acc: 0.9979 - val_loss: 0.0796 - val_acc: 0.9800
    Epoch 125/200
    13500/13500 [==============================] - 111s - loss: 0.0077 - acc: 0.9973 - val_loss: 0.0939 - val_acc: 0.9813
    Epoch 126/200
    13500/13500 [==============================] - 111s - loss: 0.0033 - acc: 0.9989 - val_loss: 0.0956 - val_acc: 0.9773
    Epoch 127/200
    13500/13500 [==============================] - 111s - loss: 0.0027 - acc: 0.9992 - val_loss: 0.0843 - val_acc: 0.9820
    Epoch 128/200
    13500/13500 [==============================] - 111s - loss: 0.0023 - acc: 0.9993 - val_loss: 0.0938 - val_acc: 0.9807
    Epoch 129/200
    13500/13500 [==============================] - 111s - loss: 0.0012 - acc: 0.9996 - val_loss: 0.1031 - val_acc: 0.9807
    Epoch 130/200
    13500/13500 [==============================] - 111s - loss: 0.0040 - acc: 0.9988 - val_loss: 0.0939 - val_acc: 0.9847
    Epoch 131/200
    13500/13500 [==============================] - 111s - loss: 0.0024 - acc: 0.9990 - val_loss: 0.1065 - val_acc: 0.9807
    Epoch 132/200
    13500/13500 [==============================] - 111s - loss: 0.0042 - acc: 0.9990 - val_loss: 0.0844 - val_acc: 0.9853
    Epoch 133/200
    13500/13500 [==============================] - 111s - loss: 0.0082 - acc: 0.9973 - val_loss: 0.0852 - val_acc: 0.9800
    Epoch 134/200
    13500/13500 [==============================] - 111s - loss: 0.0041 - acc: 0.9987 - val_loss: 0.0862 - val_acc: 0.9820
    Epoch 135/200
    13500/13500 [==============================] - 111s - loss: 0.0043 - acc: 0.9984 - val_loss: 0.0897 - val_acc: 0.9813
    Epoch 136/200
    13500/13500 [==============================] - 111s - loss: 0.0018 - acc: 0.9993 - val_loss: 0.0937 - val_acc: 0.9840
    Epoch 137/200
    13500/13500 [==============================] - 111s - loss: 0.0029 - acc: 0.9991 - val_loss: 0.0933 - val_acc: 0.9813
    Epoch 138/200
    13500/13500 [==============================] - 111s - loss: 0.0029 - acc: 0.9990 - val_loss: 0.1021 - val_acc: 0.9800
    Epoch 139/200
    13500/13500 [==============================] - 111s - loss: 0.0015 - acc: 0.9994 - val_loss: 0.0887 - val_acc: 0.9820
    Epoch 140/200
    13500/13500 [==============================] - 111s - loss: 0.0034 - acc: 0.9988 - val_loss: 0.1619 - val_acc: 0.9700
    Epoch 141/200
    13500/13500 [==============================] - 111s - loss: 0.0059 - acc: 0.9981 - val_loss: 0.0878 - val_acc: 0.9827
    Epoch 142/200
    13500/13500 [==============================] - 111s - loss: 0.0037 - acc: 0.9990 - val_loss: 0.0886 - val_acc: 0.9813
    Epoch 143/200
    13500/13500 [==============================] - 111s - loss: 0.0070 - acc: 0.9976 - val_loss: 0.1008 - val_acc: 0.9800
    Epoch 144/200
    13500/13500 [==============================] - 111s - loss: 0.0039 - acc: 0.9986 - val_loss: 0.0973 - val_acc: 0.9820
    Epoch 145/200
    13500/13500 [==============================] - 111s - loss: 0.0055 - acc: 0.9982 - val_loss: 0.1077 - val_acc: 0.9767
    Epoch 146/200
    13500/13500 [==============================] - 111s - loss: 0.0018 - acc: 0.9996 - val_loss: 0.0962 - val_acc: 0.9787
    Epoch 147/200
    13500/13500 [==============================] - 111s - loss: 0.0041 - acc: 0.9987 - val_loss: 0.0942 - val_acc: 0.9793
    Epoch 148/200
    13500/13500 [==============================] - 111s - loss: 0.0018 - acc: 0.9992 - val_loss: 0.0959 - val_acc: 0.9840
    Epoch 149/200
    13500/13500 [==============================] - 111s - loss: 0.0027 - acc: 0.9990 - val_loss: 0.1154 - val_acc: 0.9807
    Epoch 150/200
    13500/13500 [==============================] - 111s - loss: 0.0061 - acc: 0.9980 - val_loss: 0.0897 - val_acc: 0.9813
    Epoch 151/200
    13500/13500 [==============================] - 111s - loss: 0.0041 - acc: 0.9984 - val_loss: 0.1134 - val_acc: 0.9780
    Epoch 152/200
    13500/13500 [==============================] - 111s - loss: 0.0024 - acc: 0.9993 - val_loss: 0.0922 - val_acc: 0.9820
    Epoch 153/200
    13500/13500 [==============================] - 111s - loss: 0.0020 - acc: 0.9994 - val_loss: 0.1051 - val_acc: 0.9787
    Epoch 154/200
    13500/13500 [==============================] - 111s - loss: 0.0015 - acc: 0.9995 - val_loss: 0.1142 - val_acc: 0.9773
    Epoch 155/200
    13500/13500 [==============================] - 111s - loss: 0.0016 - acc: 0.9996 - val_loss: 0.1080 - val_acc: 0.9807
    Epoch 156/200
    13500/13500 [==============================] - 111s - loss: 0.0011 - acc: 0.9996 - val_loss: 0.1058 - val_acc: 0.9807
    Epoch 157/200
    13500/13500 [==============================] - 111s - loss: 4.9034e-04 - acc: 0.9999 - val_loss: 0.1200 - val_acc: 0.9800
    Epoch 158/200
    13500/13500 [==============================] - 111s - loss: 0.0030 - acc: 0.9992 - val_loss: 0.1347 - val_acc: 0.9773
    Epoch 159/200
    13500/13500 [==============================] - 113s - loss: 0.0064 - acc: 0.9983 - val_loss: 0.1114 - val_acc: 0.9793
    Epoch 160/200
    13500/13500 [==============================] - 113s - loss: 0.0016 - acc: 0.9993 - val_loss: 0.1311 - val_acc: 0.9793
    Epoch 161/200
    13500/13500 [==============================] - 112s - loss: 0.0030 - acc: 0.9987 - val_loss: 0.1252 - val_acc: 0.9773
    Epoch 162/200
    13500/13500 [==============================] - 112s - loss: 0.0057 - acc: 0.9984 - val_loss: 0.1114 - val_acc: 0.9793
    Epoch 163/200
    13500/13500 [==============================] - 112s - loss: 0.0023 - acc: 0.9992 - val_loss: 0.1061 - val_acc: 0.9847
    Epoch 164/200
    13500/13500 [==============================] - 112s - loss: 0.0023 - acc: 0.9990 - val_loss: 0.1238 - val_acc: 0.9793
    Epoch 165/200
    13500/13500 [==============================] - 110s - loss: 0.0023 - acc: 0.9990 - val_loss: 0.1046 - val_acc: 0.9820
    Epoch 166/200
    13500/13500 [==============================] - 110s - loss: 0.0033 - acc: 0.9990 - val_loss: 0.1047 - val_acc: 0.9807
    Epoch 167/200
    13500/13500 [==============================] - 111s - loss: 0.0033 - acc: 0.9989 - val_loss: 0.1087 - val_acc: 0.9800
    Epoch 168/200
    13500/13500 [==============================] - 110s - loss: 0.0011 - acc: 0.9996 - val_loss: 0.1133 - val_acc: 0.9813
    Epoch 169/200
    13500/13500 [==============================] - 110s - loss: 0.0075 - acc: 0.9979 - val_loss: 0.0935 - val_acc: 0.9840
    Epoch 170/200
    13500/13500 [==============================] - 111s - loss: 0.0028 - acc: 0.9991 - val_loss: 0.0918 - val_acc: 0.9813
    Epoch 171/200
    13500/13500 [==============================] - 111s - loss: 0.0037 - acc: 0.9987 - val_loss: 0.1015 - val_acc: 0.9820
    Epoch 172/200
    13500/13500 [==============================] - 110s - loss: 0.0072 - acc: 0.9979 - val_loss: 0.0950 - val_acc: 0.9800
    Epoch 173/200
    13500/13500 [==============================] - 110s - loss: 0.0094 - acc: 0.9973 - val_loss: 0.0914 - val_acc: 0.9853
    Epoch 174/200
    13500/13500 [==============================] - 110s - loss: 0.0066 - acc: 0.9979 - val_loss: 0.0984 - val_acc: 0.9793
    Epoch 175/200
    13500/13500 [==============================] - 110s - loss: 0.0036 - acc: 0.9990 - val_loss: 0.0907 - val_acc: 0.9787
    Epoch 176/200
    13500/13500 [==============================] - 110s - loss: 0.0020 - acc: 0.9993 - val_loss: 0.0915 - val_acc: 0.9827
    Epoch 177/200
    13500/13500 [==============================] - 110s - loss: 0.0029 - acc: 0.9990 - val_loss: 0.1003 - val_acc: 0.9813
    Epoch 178/200
    13500/13500 [==============================] - 110s - loss: 0.0031 - acc: 0.9987 - val_loss: 0.0979 - val_acc: 0.9827
    Epoch 179/200
    13500/13500 [==============================] - 110s - loss: 0.0032 - acc: 0.9989 - val_loss: 0.0976 - val_acc: 0.9820
    Epoch 180/200
    13500/13500 [==============================] - 110s - loss: 0.0020 - acc: 0.9995 - val_loss: 0.0901 - val_acc: 0.9827
    Epoch 181/200
    13500/13500 [==============================] - 110s - loss: 0.0041 - acc: 0.9983 - val_loss: 0.0922 - val_acc: 0.9833
    Epoch 182/200
    13500/13500 [==============================] - 111s - loss: 0.0044 - acc: 0.9987 - val_loss: 0.1134 - val_acc: 0.9733
    Epoch 183/200
    13500/13500 [==============================] - 110s - loss: 0.0032 - acc: 0.9988 - val_loss: 0.0910 - val_acc: 0.9793
    Epoch 184/200
    13500/13500 [==============================] - 110s - loss: 0.0018 - acc: 0.9994 - val_loss: 0.0912 - val_acc: 0.9807
    Epoch 185/200
    13500/13500 [==============================] - 110s - loss: 0.0020 - acc: 0.9991 - val_loss: 0.1228 - val_acc: 0.9787
    Epoch 186/200
    13500/13500 [==============================] - 110s - loss: 0.0051 - acc: 0.9982 - val_loss: 0.1056 - val_acc: 0.9800
    Epoch 187/200
    13500/13500 [==============================] - 110s - loss: 0.0060 - acc: 0.9985 - val_loss: 0.0852 - val_acc: 0.9807
    Epoch 188/200
    13500/13500 [==============================] - 110s - loss: 0.0041 - acc: 0.9987 - val_loss: 0.1102 - val_acc: 0.9747
    Epoch 189/200
    13500/13500 [==============================] - 110s - loss: 0.0031 - acc: 0.9987 - val_loss: 0.0788 - val_acc: 0.9820
    Epoch 190/200
    13500/13500 [==============================] - 111s - loss: 0.0022 - acc: 0.9992 - val_loss: 0.0891 - val_acc: 0.9807
    Epoch 191/200
    13500/13500 [==============================] - 110s - loss: 0.0029 - acc: 0.9991 - val_loss: 0.0885 - val_acc: 0.9820
    Epoch 192/200
    13500/13500 [==============================] - 110s - loss: 5.3104e-04 - acc: 0.9999 - val_loss: 0.0906 - val_acc: 0.9820
    Epoch 193/200
    13500/13500 [==============================] - 110s - loss: 0.0017 - acc: 0.9995 - val_loss: 0.1200 - val_acc: 0.9760
    Epoch 194/200
    13500/13500 [==============================] - 110s - loss: 0.0038 - acc: 0.9987 - val_loss: 0.1117 - val_acc: 0.9807
    Epoch 195/200
    13500/13500 [==============================] - 111s - loss: 0.0023 - acc: 0.9994 - val_loss: 0.1178 - val_acc: 0.9807
    Epoch 196/200
    13500/13500 [==============================] - 110s - loss: 0.0036 - acc: 0.9989 - val_loss: 0.1116 - val_acc: 0.9767
    Epoch 197/200
    13500/13500 [==============================] - 110s - loss: 0.0029 - acc: 0.9990 - val_loss: 0.1128 - val_acc: 0.9800
    Epoch 198/200
    13500/13500 [==============================] - 110s - loss: 0.0013 - acc: 0.9996 - val_loss: 0.1012 - val_acc: 0.9847
    Epoch 199/200
    13500/13500 [==============================] - 110s - loss: 0.0048 - acc: 0.9983 - val_loss: 0.1366 - val_acc: 0.9767
    Epoch 200/200
    13500/13500 [==============================] - 110s - loss: 0.0047 - acc: 0.9985 - val_loss: 0.1072 - val_acc: 0.9807
    Testing...
    5000/5000 [==============================] - 12s    
    Test accuracy: 0.9844
    


```python
model_json = model.to_json()
open('jianghuang_articture.json', 'w').write(model_json)
model.save_weights('jianhuang_weights.h5', overwrite=True)
```


```python
import numpy as np
import scipy.misc
import os
```


```python
def load_and_scale_imgs():
   img_names = os.listdir('imgs_p/')

   imgs = [np.transpose(scipy.misc.imresize(scipy.misc.imread('imgs_p/'+img_name), (32, 32)),
                        (2, 0, 1)).astype('float32')
           for img_name in img_names]
   return np.array(imgs) / 255
```


```python
imgs = load_and_scale_imgs()
```


```python
predictions = model.predict_classes(imgs)
```

    10000/10000 [==============================] - 21s    
    


```python
predictions
```




    array([1, 1, 1, ..., 1, 1, 1], dtype=int64)




```python
def predictImage(url):
    img_names = [url,]
    imgs = [np.transpose(scipy.misc.imresize(scipy.misc.imread(img_name), (32, 32)),
                        (2, 0, 1)).astype('float32')
           for img_name in img_names]
    imgs = np.array(imgs) / 255
    predictions = model.predict_classes(imgs)
    return predictions
```


```python
predictImage('imgs_p/whgnhb1star003pl111.jpg')
```

    1/1 [==============================] - 0s
    




    array([1], dtype=int64)




```python
predictImage('imgs_n/100065_01111.jpg')
```

    1/1 [==============================] - 0s
    




    array([0], dtype=int64)




```python

```
